# Copyright (C) 2022 joe <joe@thisisjoes.site>
# SPDX-License-Identifier: GPL-3.0-only

SynapseDestinationReset() {
  Log debug "Got args '$*'"

  DoDestinationReset() {
    local -A params=(
      [method]="${s_destination_reset_api[method]}"
      [path]="${s_destination_reset_api[path]}"
    )
    local response
    Request params response || {
      HandleMatrixError response
      return 1
    }

    echo -e "\nDestination timeout reset"
  }

  CheckLoginStatus || return 1
  CheckServerSupport "${s_destination_reset_api[minimum_version]}" || return 1

  Log info "Getting destination reset from ${config[homeserver]}"

  Read -r -p "Destination:" input_destination
    ValidateInput host "$input_destination" || return 1
    local destination="$input_destination"
    Log debug "Destination is '$destination'"
    s_destination_reset_url_params[destination]="$destination"
    Log debug "URL 'destination' param set to '${s_destination_reset_url_params[destination]}'"

  DefineSynapseEndpoints
  DoDestinationReset
}
